<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>سیستم  ثبت نام</title>
<style>
body{
    margin:0;
    font-family:tahoma;
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    background:radial-gradient(circle at top right,#3b0f70,#0b1c2d 60%);
}
.container{
    width:420px;
    padding:40px 35px;
    border-radius:25px;
    background:rgba(255,255,255,0.06);
    backdrop-filter:blur(20px);
    border:1px solid rgba(255,255,255,0.08);
    box-shadow:0 0 60px rgba(128,0,255,.25),0 20px 40px rgba(0,0,0,.6);
    color:#fff;
}
h2{text-align:center;margin-bottom:30px;font-weight:600;}
input,select,textarea{
    width:100%;
    padding:14px;
    margin-top:15px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,0.15);
    background:rgba(255,255,255,0.08);
    color:#fff;
    font-size:14px;
    outline:none;
    transition:.3s;
    box-sizing:border-box;
}
select option{
    background:#1e1e2f;
    color:#ffffff;
}
input:focus,select:focus,textarea:focus{
    border:1px solid #9d4edd;
    box-shadow:0 0 15px rgba(157,78,221,.4);
}
button{
    width:100%;
    padding:14px;
    margin-top:25px;
    border:none;
    border-radius:14px;
    background:linear-gradient(90deg,#9d4edd,#7b2cbf);
    color:#fff;
    cursor:pointer;
}
button:disabled{opacity:.5;cursor:not-allowed;}
.link-row{text-align:center;margin-top:20px;font-size:13px;}
.link-action{color:#c77dff;cursor:pointer;margin-right:6px;font-weight:bold;}
.success{text-align:center;color:#80ffdb;margin-top:10px;}
.hidden{display:none;}
</style>
</head>
<body>

<div class="container">

<div id="loginBox">
<h2>ورود</h2>
<input type="text" id="loginNational" placeholder="کد ملی" maxlength="10">
<button id="loginBtn" disabled>ادامه</button>
<div class="success" id="loginMsg"></div>
<div class="link-row">
ثبت نام نکرده‌ای؟
<span class="link-action" onclick="showRegister()">ثبت نام</span>
</div>
</div>

<div id="registerBox" class="hidden">
<h2>ثبت نام</h2>
<div id="stepRole">
<select id="roleSelect">
<option value="">انتخاب نقش</option>
<option value="student">دانش آموز</option>
<option value="teacher">استاد</option>
<option value="school">مدرسه</option>
</select>
<button id="roleNext" disabled>تایید</button>
</div>

<div id="studentForm" class="hidden">
<div id="studentStep1">
<input type="text" id="s_fullName" placeholder="نام و نام خانوادگی">
<input type="text" id="s_phone" placeholder="شماره تماس">
<input type="text" id="s_nationalCode" placeholder="کد ملی" maxlength="10">
<input type="date" id="s_birthDate">
<select id="s_school">
<option value="">انتخاب مدرسه</option>
<option>هنرستان فضا</option>
<option>هنرستان سما</option>
</select>
<button onclick="nextStep('studentStep1','studentStep2')">مرحله بعد</button>
</div>

<div id="studentStep2" class="hidden">
<select id="levelSelect" onchange="updateGrades()">
<option value="">انتخاب مقطع</option>
<option value="primary">ابتدایی</option>
<option value="middle">راهنمایی</option>
<option value="high">دبیرستان</option>
</select>
<select id="gradeSelect" class="hidden"></select>
<select id="majorSelect" class="hidden">
<option value="">انتخاب رشته</option>
<option>ریاضی</option>
<option>علوم تجربی</option>
<option>انسانی</option>
<option>فنی حرفه‌ای</option>
<option>کاردانش</option>
</select>
<button type="button" onclick="submitStudent()">ثبت نهایی</button>
</div>
</div>
</div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw4GPVh7HVTjzqRtf5cv7ZYpGx6sk4Dgtm8Gxhtamjr6D-CmtnNrcfbfTd3PnUugWCw/exec";

/* ورود */
const loginNational = document.getElementById("loginNational");
const loginBtn = document.getElementById("loginBtn");
loginNational.addEventListener("input", function(){
    loginBtn.disabled = this.value.length !== 10;
});

function showRegister(){
    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("registerBox").classList.remove("hidden");
}

/* انتخاب نقش */
const roleSelect = document.getElementById("roleSelect");
const roleNext = document.getElementById("roleNext");
roleSelect.addEventListener("change",function(){
    roleNext.disabled = this.value==="";
});
roleNext.onclick = function(){
    document.getElementById("stepRole").classList.add("hidden");
    if(roleSelect.value==="student") document.getElementById("studentForm").classList.remove("hidden");
}

/* مراحل فرم دانش آموز */
function nextStep(current,next){
    document.getElementById(current).classList.add("hidden");
    document.getElementById(next).classList.remove("hidden");
}

/* بروزرسانی کلاس‌ها و رشته‌ها */
function updateGrades(){
    const levelSelect = document.getElementById("levelSelect");
    const gradeSelect = document.getElementById("gradeSelect");
    const majorSelect = document.getElementById("majorSelect");
    gradeSelect.innerHTML = "";
    gradeSelect.classList.remove("hidden");
    majorSelect.classList.add("hidden");

    if(levelSelect.value==="primary"){
        gradeSelect.innerHTML='<option>اول</option><option>دوم</option><option>سوم</option><option>چهارم</option><option>پنجم</option><option>ششم</option>';
    } else if(levelSelect.value==="middle"){
        gradeSelect.innerHTML='<option>هفتم</option><option>هشتم</option><option>نهم</option>';
    } else if(levelSelect.value==="high"){
        gradeSelect.innerHTML='<option>دهم</option><option>یازدهم</option><option>دوازدهم</option>';
        majorSelect.classList.remove("hidden");
    }
}

/* تابع اصلی ثبت دانش‌آموز */
async function submitStudent() {
  const data = {
    fullName: document.getElementById("s_fullName").value,
    phone: document.getElementById("s_phone").value,
    nationalCode: document.getElementById("s_nationalCode").value,
    birthDate: document.getElementById("s_birthDate").value,
    schoolName: document.getElementById("s_school").value,
    level: document.getElementById("levelSelect").value,
    grade: document.getElementById("gradeSelect").value,
    major: document.getElementById("majorSelect").value
  };

  try {
    const res = await fetch(SCRIPT_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    const result = await res.json();

    if (result.status === "success") {
      alert(`ثبت نام با موفقیت انجام شد ✅\nID: ${result.id}\nتاریخ ثبت: ${new Date(result.registerDate).toLocaleString()}`);
      
      document.getElementById("studentForm").querySelectorAll("input,select").forEach(el => el.value = "");
      document.getElementById("studentStep1").classList.remove("hidden");
      document.getElementById("studentStep2").classList.add("hidden");
    } else {
      alert("خطا: " + result.message);
    }

  } catch (err) {
    console.error(err);
    alert("خطا در ارسال اطلاعات ❌\n" + err.message);
  }
}
</script>

</body>
</html>
